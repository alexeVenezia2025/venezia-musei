<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèõÔ∏è Venezia Musei</title>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f5f0 0%, #faf9f6 100%);
            overflow: hidden;
        }

        /* Login Screen */
        #login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #81C9DF 0%, #6ab5cc 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 50px 40px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .login-box h1 {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .login-box p {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .login-box input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .login-box input:focus {
            outline: none;
            border-color: #81C9DF;
        }

        .login-box button {
            width: 100%;
            padding: 15px;
            background: #81C9DF;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-box button:hover {
            background: #6ab5cc;
            transform: translateY(-2px);
        }

        /* Header */
        #header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.05);
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }

        .language-switch {
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: #f0f0f0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s;
        }

        .lang-btn.active {
            background: #81C9DF;
            transform: scale(1.1);
        }

        .maps-links {
            display: flex;
            gap: 10px;
        }

        .map-link {
            padding: 10px 20px;
            background: #f5f5f5;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
            text-decoration: none;
            color: #333;
        }

        .map-link.current {
            background: #81C9DF;
            color: white;
            font-weight: 600;
        }

        .map-link:hover:not(.current) {
            background: #e0e0e0;
        }

        /* Main Container */
        #main-container {
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
        }

        /* Sidebar */
        #sidebar {
            width: 320px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            overflow-y: auto;
            box-shadow: 2px 0 20px rgba(0,0,0,0.05);
        }

        .sidebar-header {
            padding: 20px;
            background: #81C9DF;
            color: white;
        }

        .sidebar-header h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .place-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .place-item:hover {
            background: #f8f8f8;
        }

        .place-item.active {
            background: #e8f6fa;
            border-left: 4px solid #81C9DF;
        }

        .place-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .place-duration {
            font-size: 13px;
            color: #81C9DF;
        }

        /* Map */
        #map {
            flex: 1;
        }

        /* Popup Custom */
        .mapboxgl-popup-content {
            padding: 0;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            max-width: 400px;
            overflow: hidden;
        }

        .popup-header {
            padding: 20px;
            background: linear-gradient(135deg, #81C9DF 0%, #6ab5cc 100%);
            color: white;
        }

        .popup-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .popup-duration {
            font-size: 14px;
            opacity: 0.9;
        }

        .popup-body {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .popup-main-description {
            color: #333;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        /* Carousel */
        .carousel-container {
            position: relative;
            margin-top: 20px;
        }

        .carousel-section {
            display: none;
            animation: fadeIn 0.3s;
        }

        .carousel-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section-header {
            padding: 15px;
            background: #f8f4f0;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .section-description {
            color: #666;
            line-height: 1.6;
            font-size: 14px;
        }

        .carousel-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .carousel-btn {
            background: #81C9DF;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
        }

        .carousel-btn:hover {
            background: #6ab5cc;
            transform: scale(1.1);
        }

        .carousel-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: scale(1);
        }

        .carousel-dots {
            display: flex;
            gap: 8px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ddd;
            transition: all 0.3s;
        }

        .dot.active {
            background: #81C9DF;
            width: 24px;
            border-radius: 4px;
        }

        /* How to Arrive */
        .how-to-arrive {
            margin-top: 20px;
            padding: 15px;
            background: #f0f8fa;
            border-radius: 12px;
            border-left: 4px solid #81C9DF;
        }

        .how-to-arrive h4 {
            color: #81C9DF;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .how-to-arrive p {
            color: #666;
            line-height: 1.6;
            font-size: 14px;
        }

        /* Admin Panel */
        .admin-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: #81C9DF;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(129, 201, 223, 0.4);
            transition: all 0.3s;
            z-index: 999;
        }

        .admin-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(129, 201, 223, 0.6);
        }

        .admin-panel {
            display: none;
            position: fixed;
            top: 70px;
            right: 0;
            width: 400px;
            height: calc(100% - 70px);
            background: white;
            box-shadow: -2px 0 20px rgba(0,0,0,0.1);
            padding: 30px;
            overflow-y: auto;
            z-index: 998;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-panel h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .admin-panel button {
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: #81C9DF;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .admin-panel button:hover {
            background: #6ab5cc;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen">
        <div class="login-box">
            <h1>üèõÔ∏è Venezia Musei</h1>
            <p>Inserisci la password per accedere</p>
            <input type="password" id="password-input" placeholder="Password">
            <button onclick="checkPassword()">Accedi</button>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="hidden">
        <!-- Header -->
        <div id="header">
            <div class="header-left">
                <span class="header-title">üèõÔ∏è <span id="header-title-text">Musei di Venezia</span></span>
                <div class="language-switch">
                    <button class="lang-btn active" onclick="setLanguage('it')">üáÆüáπ</button>
                    <button class="lang-btn" onclick="setLanguage('en')">üá¨üáß</button>
                </div>
            </div>
            <div class="maps-links">
                <a href="#" class="map-link current">üèõÔ∏è</a>
                <a href="venezia-chiese.html" class="map-link">‚õ™</a>
                <a href="venezia-palazzi.html" class="map-link">üè∞</a>
                <a href="venezia-attrazioni.html" class="map-link">üé≠</a>
            </div>
        </div>

        <!-- Main Container -->
        <div id="main-container">
            <!-- Sidebar -->
            <div id="sidebar">
                <div class="sidebar-header">
                    <h2 id="sidebar-title">Legenda Musei</h2>
                </div>
                <div id="places-list"></div>
            </div>

            <!-- Map -->
            <div id="map"></div>
        </div>

        <!-- Admin Button -->
        <button class="admin-btn" onclick="toggleAdmin()">‚öôÔ∏è</button>

        <!-- Admin Panel -->
        <div id="admin-panel" class="admin-panel">
            <h3>üîß Gestione Dati</h3>
            <button onclick="exportData()">üì• Esporta Dati (JSON)</button>
            <button onclick="document.getElementById('import-file').click()">üì§ Importa Dati (JSON)</button>
            <input type="file" id="import-file" accept=".json" style="display:none" onchange="importData(event)">
            <button onclick="addNewPlace()">‚ûï Aggiungi Nuovo Museo</button>
            <button onclick="resetToDefault()">üîÑ Ripristina Dati Predefiniti</button>
        </div>
    </div>

    <script>
        // Configuration
        mapboxgl.accessToken = 'pk.eyJ1IjoiYWxleGVhbmdlbGEiLCJhIjoiY21nNnltb3lqMG00NjJtc2U1MGwzeGhkYiJ9.-b-5VYMsx38e2YB6JB4qEw';
        const PASSWORD = 'venezia2025';
        let currentLanguage = 'it';
        let map;
        let markers = [];
        let currentPopup = null;

        // Museums Data
        const defaultMuseums = [
            {
                id: 1,
                name: { it: "Palazzo Ducale", en: "Doge's Palace" },
                duration: 120,
                coordinates: [12.3407, 45.4332],
                description: {
                    it: "Il Palazzo Ducale √® stato per secoli il centro del potere politico veneziano, residenza del Doge e sede delle magistrature. Capolavoro dell'arte gotica veneziana, affaccia sulla Piazza San Marco e sul Bacino di San Marco.",
                    en: "The Doge's Palace was for centuries the center of Venetian political power, residence of the Doge and seat of magistrates. A masterpiece of Venetian Gothic art, it overlooks St. Mark's Square and the St. Mark's Basin."
                },
                subsections: [
                    {
                        title: { it: "Architettura e Storia", en: "Architecture and History" },
                        description: { it: "L'attuale edificio risale principalmente al XIV-XV secolo. La facciata presenta un elegante loggiato al piano terra e al primo piano, sormontato da un corpo compatto rivestito di marmi bianchi e rosa. Il palazzo √® collegato alle Prigioni Nuove attraverso il celebre Ponte dei Sospiri.", en: "The current building dates mainly from the 14th-15th century. The facade features an elegant loggia on the ground and first floors, surmounted by a compact body covered with white and pink marble. The palace is connected to the New Prisons through the famous Bridge of Sighs." }
                    },
                    {
                        title: { it: "Sale Principali", en: "Main Halls" },
                        description: { it: "All'interno si trovano capolavori come la Sala del Maggior Consiglio con il 'Paradiso' di Tintoretto, la Sala del Senato, la Sala del Collegio con opere di Veronese, e gli appartamenti del Doge. Ogni sala √® riccamente decorata con dipinti, stucchi e ori.", en: "Inside you'll find masterpieces such as the Great Council Hall with Tintoretto's 'Paradise', the Senate Hall, the Collegio Hall with works by Veronese, and the Doge's apartments. Each room is richly decorated with paintings, stuccos and gold." }
                    },
                    {
                        title: { it: "Prigioni e Ponte dei Sospiri", en: "Prisons and Bridge of Sighs" },
                        description: { it: "Le prigioni sotterranee ('Pozzi') e le Prigioni Nuove sono collegate al palazzo dal Ponte dei Sospiri (1614). Il nome deriva dai sospiri dei condannati che, attraversandolo, davano l'ultimo sguardo alla laguna.", en: "The underground prisons ('Pozzi') and the New Prisons are connected to the palace by the Bridge of Sighs (1614). The name comes from the sighs of the condemned who, crossing it, took their last look at the lagoon." }
                    }
                ],
                howToArrive: {
                    it: "Vaporetto: linee 1, 2, 5.1, 5.2 fermata San Marco-San Zaccaria. A piedi da Piazza San Marco.",
                    en: "Vaporetto: lines 1, 2, 5.1, 5.2 stop at San Marco-San Zaccaria. Walking from St. Mark's Square."
                }
            },
            {
                id: 2,
                name: { it: "Gallerie dell'Accademia", en: "Accademia Galleries" },
                duration: 90,
                coordinates: [12.3282, 45.4312],
                description: {
                    it: "Le Gallerie dell'Accademia ospitano la pi√π importante collezione di arte veneziana al mondo, con opere dal XIV al XVIII secolo. Si trovano nell'ex complesso della Scuola Grande di Santa Maria della Carit√†.",
                    en: "The Accademia Galleries house the world's most important collection of Venetian art, with works from the 14th to 18th centuries. Located in the former complex of the Scuola Grande di Santa Maria della Carit√†."
                },
                subsections: [
                    {
                        title: { it: "Capolavori Veneziani", en: "Venetian Masterpieces" },
                        description: { it: "La collezione include opere di Bellini, Giorgione, Tiziano, Tintoretto, Veronese e Canaletto. Tra i capolavori: 'L'Uomo Vitruviano' di Leonardo (esposto raramente), 'La Tempesta' di Giorgione, 'La Cena in Casa Levi' di Veronese.", en: "The collection includes works by Bellini, Giorgione, Titian, Tintoretto, Veronese and Canaletto. Among the masterpieces: Leonardo's 'Vitruvian Man' (rarely exhibited), Giorgione's 'The Tempest', Veronese's 'Feast in the House of Levi'." }
                    },
                    {
                        title: { it: "Scuole Veneziane", en: "Venetian Schools" },
                        description: { it: "Il museo documenta l'evoluzione della pittura veneziana attraverso i secoli, dalle icone bizantine di Paolo Veneziano ai vedutisti del Settecento come Canaletto e Guardi. √à possibile seguire l'evoluzione del colore e della luce tipici della scuola veneziana.", en: "The museum documents the evolution of Venetian painting through the centuries, from Byzantine icons by Paolo Veneziano to 18th-century vedutisti like Canaletto and Guardi. You can follow the evolution of color and light typical of the Venetian school." }
                    },
                    {
                        title: { it: "Architettura del Complesso", en: "Complex Architecture" },
                        description: { it: "L'edificio comprende l'antica chiesa gotica della Carit√†, la Scuola Grande e il Convento dei Canonici Lateranensi. Nel 1750 l'architetto Giorgio Massari ristruttur√≤ parte del complesso, creando gli spazi espositivi attuali.", en: "The building includes the ancient Gothic church of Carit√†, the Scuola Grande and the Convent of the Lateran Canons. In 1750 architect Giorgio Massari renovated part of the complex, creating the current exhibition spaces." }
                    }
                ],
                howToArrive: {
                    it: "Vaporetto: linea 1 o 2 fermata Accademia. Si trova sul Canal Grande vicino al Ponte dell'Accademia.",
                    en: "Vaporetto: line 1 or 2 stop Accademia. Located on the Grand Canal near the Accademia Bridge."
                }
            },
            {
                id: 3,
                name: { it: "Ca' Rezzonico", en: "Ca' Rezzonico" },
                duration: 75,
                coordinates: [12.3266, 45.4335],
                description: {
                    it: "Ca' Rezzonico √® uno splendido palazzo barocco sul Canal Grande che ospita il Museo del Settecento Veneziano. Offre un'immersione completa nella vita aristocratica veneziana del XVIII secolo.",
                    en: "Ca' Rezzonico is a splendid Baroque palace on the Grand Canal housing the Museum of 18th Century Venice. It offers a complete immersion in 18th-century Venetian aristocratic life."
                },
                subsections: [
                    {
                        title: { it: "Palazzo e Collezioni", en: "Palace and Collections" },
                        description: { it: "Progettato da Baldassare Longhena nel 1667 e completato da Giorgio Massari nel 1750, il palazzo conserva arredi originali, affreschi di Tiepolo, dipinti di Canaletto, Guardi e Longhi, oltre a mobili, ceramiche e oggetti d'uso quotidiano del Settecento.", en: "Designed by Baldassare Longhena in 1667 and completed by Giorgio Massari in 1750, the palace preserves original furnishings, frescoes by Tiepolo, paintings by Canaletto, Guardi and Longhi, as well as furniture, ceramics and everyday objects from the 18th century." }
                    },
                    {
                        title: { it: "Sale Affrescate", en: "Frescoed Halls" },
                        description: { it: "Il Salone da Ballo al secondo piano √® decorato con splendidi affreschi allegorici di Giambattista Tiepolo. La Sala dell'Allegoria Nuziale conserva uno dei pi√π bei cicli decorativi del Settecento veneziano, opera di Tiepolo padre e figlio.", en: "The Ballroom on the second floor is decorated with splendid allegorical frescoes by Giambattista Tiepolo. The Nuptial Allegory Room preserves one of the most beautiful decorative cycles of 18th-century Venice, work of Tiepolo father and son." }
                    },
                    {
                        title: { it: "Farmacia e Curiosit√†", en: "Pharmacy and Curiosities" },
                        description: { it: "Al terzo piano si trova la ricostruzione completa di una farmacia settecentesca con mobili, vasi e strumenti originali. Il palazzo ospita anche la Pinacoteca Egidio Martini con opere di Cima da Conegliano, Alvise Vivarini e altri maestri veneti.", en: "On the third floor there is a complete reconstruction of an 18th-century pharmacy with original furniture, jars and instruments. The palace also houses the Egidio Martini Picture Gallery with works by Cima da Conegliano, Alvise Vivarini and other Venetian masters." }
                    }
                ],
                howToArrive: {
                    it: "Vaporetto: linea 1 fermata Ca' Rezzonico. Si trova sul Canal Grande nel sestiere di Dorsoduro.",
                    en: "Vaporetto: line 1 stop Ca' Rezzonico. Located on the Grand Canal in the Dorsoduro district."
                }
            },
            {
                id: 4,
                name: { it: "Museo Correr", en: "Correr Museum" },
                duration: 90,
                coordinates: [12.3378, 45.4338],
                description: {
                    it: "Il Museo Correr in Piazza San Marco racconta la storia di Venezia attraverso opere d'arte, documenti storici e oggetti della vita quotidiana. Nato dalla collezione di Teodoro Correr, offre un viaggio nella civilt√† veneziana.",
                    en: "The Correr Museum in St. Mark's Square tells the history of Venice through works of art, historical documents and objects of daily life. Born from Teodoro Correr's collection, it offers a journey into Venetian civilization."
                },
                subsections: [
                    {
                        title: { it: "Percorso Storico", en: "Historical Route" },
                        description: { it: "Il museo si articola in sezioni dedicate alla storia della Serenissima: simboli dogali, armature, strumenti navali, globi, mappe antiche, monete e documenti che narrano mille anni di storia. Include gli Appartamenti Imperiali di epoca napoleonica.", en: "The museum is divided into sections dedicated to the history of the Serenissima: dogal symbols, armor, naval instruments, globes, ancient maps, coins and documents that narrate a thousand years of history. Includes Imperial Apartments from the Napoleonic era." }
                    },
                    {
                        title: { it: "Pinacoteca", en: "Art Gallery" },
                        description: { it: "La Quadreria ospita capolavori della pittura veneta: opere di Cosm√® Tura, Antonello da Messina, i Bellini, Carpaccio ('Due Dame Veneziane'), Lorenzo Lotto. La collezione documenta l'evoluzione artistica dal Medioevo al Rinascimento.", en: "The Picture Gallery houses masterpieces of Venetian painting: works by Cosm√® Tura, Antonello da Messina, the Bellinis, Carpaccio ('Two Venetian Ladies'), Lorenzo Lotto. The collection documents artistic evolution from the Middle Ages to the Renaissance." }
                    },
                    {
                        title: { it: "Museo del Risorgimento", en: "Risorgimento Museum" },
                        description: { it: "Una sezione √® dedicata alla Venezia dell'Ottocento e al periodo del Risorgimento, con dipinti, documenti e cimeli che narrano la fine della Repubblica (1797), il periodo austriaco e l'annessione al Regno d'Italia (1866).", en: "A section is dedicated to 19th-century Venice and the Risorgimento period, with paintings, documents and relics narrating the end of the Republic (1797), the Austrian period and annexation to the Kingdom of Italy (1866)." }
                    }
                ],
                howToArrive: {
                    it: "Vaporetto: linee 1, 2, 5.1, 5.2 fermata San Marco-Vallaresso. L'ingresso √® in Piazza San Marco, Ala Napoleonica.",
                    en: "Vaporetto: lines 1, 2, 5.1, 5.2 stop San Marco-Vallaresso. Entrance is in St. Mark's Square, Napoleonic Wing."
                }
            },
            {
                id: 5,
                name: { it: "Peggy Guggenheim Collection", en: "Peggy Guggenheim Collection" },
                duration: 60,
                coordinates: [12.3315, 45.4306],
                description: {
                    it: "Ospitata in Palazzo Venier dei Leoni sul Canal Grande, la collezione espone capolavori dell'arte moderna del XX secolo raccolti da Peggy Guggenheim. Una delle pi√π importanti collezioni europee di arte contemporanea.",
                    en: "Housed in Palazzo Venier dei Leoni on the Grand Canal, the collection displays masterpieces of 20th-century modern art collected by Peggy Guggenheim. One of Europe's most important contemporary art collections."
                },
                subsections: [
                    {
                        title: { it: "Collezione Permanente", en: "Permanent Collection" },
                        description: { it: "La collezione include opere di Picasso, Kandinsky, Mondrian, Mir√≥, Dal√≠, Magritte, Pollock, de Kooning, Ernst e molti altri. Copre cubismo, futurismo, surrealismo, espressionismo astratto e arte informale. Sculture di Brancusi, Calder e Moore decorano il giardino.", en: "The collection includes works by Picasso, Kandinsky, Mondrian, Mir√≥, Dal√≠, Magritte, Pollock, de Kooning, Ernst and many others. It covers cubism, futurism, surrealism, abstract expressionism and informal art. Sculptures by Brancusi, Calder and Moore decorate the garden." }
                    },
                    {
                        title: { it: "Palazzo e Giardino", en: "Palace and Garden" },
                        description: { it: "Palazzo Venier dei Leoni (XVIII sec.) rimase incompiuto, con solo il piano terra costruito. Peggy Guggenheim lo acquist√≤ nel 1949 e vi visse fino alla morte (1979). Il giardino affacciato sul Canal Grande ospita sculture moderne e la tomba della collezionista.", en: "Palazzo Venier dei Leoni (18th century) remained unfinished, with only the ground floor built. Peggy Guggenheim bought it in 1949 and lived there until her death (1979). The garden overlooking the Grand Canal houses modern sculptures and the collector's tomb." }
                    },
                    {
                        title: { it: "Mostre Temporanee", en: "Temporary Exhibitions" },
                        description: { it: "Il museo organizza regolarmente mostre temporanee dedicate ad artisti del XX secolo, movimenti artistici e temi specifici. Il Padiglione Giardino e gli spazi espositivi accolgono installazioni e progetti speciali in dialogo con la collezione permanente.", en: "The museum regularly organizes temporary exhibitions dedicated to 20th-century artists, artistic movements and specific themes. The Garden Pavilion and exhibition spaces host installations and special projects in dialogue with the permanent collection." }
                    }
                ],
                howToArrive: {
                    it: "Vaporetto: linea 1 o 2 fermata Accademia, poi 10 minuti a piedi. Oppure linea 2 fermata Salute.",
                    en: "Vaporetto: line 1 or 2 stop Accademia, then 10 minutes walk. Or line 2 stop Salute."
                }
            },
            {
                id: 6,
                name: { it: "Museo di Storia Naturale", en: "Natural History Museum" },
                duration: 60,
                coordinates: [12.3313, 45.4408],
                description: {
                    it: "Il Museo di Storia Naturale ha sede nel Fontego dei Turchi, palazzo bizantino del XIII secolo affacciato sul Canal Grande. Le collezioni spaziano dalla paleontologia alla zoologia, con particolare attenzione alla laguna veneziana.",
                    en: "The Natural History Museum is located in the Fontego dei Turchi, a 13th-century Byzantine palace overlooking the Grand Canal. Collections range from paleontology to zoology, with particular attention to the Venetian lagoon."
                },
                subsections: [
                    {
                        title: { it: "Dinosauri e Fossili", en: "Dinosaurs and Fossils" },
                        description: { it: "La sezione paleontologica espone lo scheletro completo di un Ouranosaurus nigeriensis e il cranio di uno Spinosaurus. Ricca collezione di fossili, tra cui il famoso coccodrillo di Bolca e pesci fossilizzati dell'Eocene.", en: "The paleontology section displays the complete skeleton of an Ouranosaurus nigeriensis and the skull of a Spinosaurus. Rich fossil collection, including the famous Bolca crocodile and fossilized Eocene fish." }
                    },
                    {
                        title: { it: "Forme della Laguna", en: "Forms of the Lagoon" },
                        description: { it: "Un percorso dedicato all'ecosistema lagunare veneziano: flora, fauna, geologia e morfologia. Acquari con specie locali, diorami che ricostruiscono gli ambienti della laguna (barene, velme, canneti) e approfondimenti sull'equilibrio ecologico.", en: "A route dedicated to the Venetian lagoon ecosystem: flora, fauna, geology and morphology. Aquariums with local species, dioramas reconstructing lagoon environments (salt marshes, mudflats, reed beds) and insights into ecological balance." }
                    },
                    {
                        title: { it: "Collezioni Naturalistiche", en: "Natural Collections" },
                        description: { it: "Il museo conserva oltre 2 milioni di reperti: conchiglie, insetti, uccelli, mammiferi, erbari. Particolarmente importante la collezione di pesci adriatici e la raccolta entomologica. Presente anche una sezione dedicata alle esplorazioni scientifiche veneziane.", en: "The museum preserves over 2 million specimens: shells, insects, birds, mammals, herbaria. Particularly important is the Adriatic fish collection and entomological collection. Also features a section dedicated to Venetian scientific explorations." }
                    }
                ],
                howToArrive: {
                    it: "Vaporetto: linea 1 fermata San Stae. Si trova nel sestiere di Santa Croce, sul Canal Grande.",
                    en: "Vaporetto: line 1 stop San Stae. Located in the Santa Croce district, on the Grand Canal."
                }
            },
            {
                id: 7,
                name: { it: "Ca' Pesaro", en: "Ca' Pesaro" },
                duration: 75,
                coordinates: [12.3296, 45.4403],
                description: {
                    it: "Ca' Pesaro √® un maestoso palazzo barocco sul Canal Grande progettato da Baldassare Longhena. Ospita la Galleria Internazionale d'Arte Moderna e il Museo d'Arte Orientale, con collezioni di grande valore artistico.",
                    en: "Ca' Pesaro is a majestic Baroque palace on the Grand Canal designed by Baldassare Longhena. It houses the International Gallery of Modern Art and the Museum of Oriental Art, with collections of great artistic value."
                },
                subsections: [
                    {
                        title: { it: "Arte Moderna", en: "Modern Art" },
                        description: { it: "La Galleria d'Arte Moderna espone opere dall'Ottocento al primo Novecento: Klimt ('Giuditta II'), Chagall, Kandinsky, Klee, Morandi, de Chirico, Boccioni, Carr√†. Forte la presenza di artisti italiani legati alla Biennale di Venezia.", en: "The Modern Art Gallery exhibits works from the 19th to early 20th century: Klimt ('Judith II'), Chagall, Kandinsky, Klee, Morandi, de Chirico, Boccioni, Carr√†. Strong presence of Italian artists connected to the Venice Biennale." }
                    },
                    {
                        title: { it: "Museo d'Arte Orientale", en: "Museum of Oriental Art" },
                        description: { it: "Al terzo piano si trova una delle pi√π importanti collezioni di arte orientale in Italia: oltre 30.000 pezzi dall'Estremo Oriente (Giappone, Cina, Indonesia). Armi samurai, porcellane, lacche, stoffe, bronzi e oggetti della Cina imperiale e del periodo Edo giapponese.", en: "On the third floor is one of Italy's most important Oriental art collections: over 30,000 pieces from the Far East (Japan, China, Indonesia). Samurai weapons, porcelain, lacquerware, fabrics, bronzes and objects from Imperial China and Japanese Edo period." }
                    },
                    {
                        title: { it: "Architettura Barocca", en: "Baroque Architecture" },
                        description: { it: "Il palazzo, iniziato da Longhena nel 1659 e completato nel 1710, √® uno dei capolavori del barocco veneziano. La facciata sul Canal Grande presenta due ordini di bifore con ricca decorazione scultorea. Gli interni conservano affreschi e stucchi d'epoca.", en: "The palace, begun by Longhena in 1659 and completed in 1710, is one of the masterpieces of Venetian Baroque. The facade on the Grand Canal has two orders of mullioned windows with rich sculptural decoration. Interiors preserve period frescoes and stuccos." }
                    }
                ],
                howToArrive: {
                    it: "Vaporetto: linea 1 fermata San Stae. Si trova nel sestiere di Santa Croce, sul Canal Grande.",
                    en: "Vaporetto: line 1 stop San Stae. Located in the Santa Croce district, on the Grand Canal."
                }
            }
        ];

        // Load data from localStorage or use default
        let museums = JSON.parse(localStorage.getItem('venezia-musei-data')) || defaultMuseums;

        // Login
        function checkPassword() {
            const input = document.getElementById('password-input').value;
            if (input === PASSWORD) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app').classList.remove('hidden');
                initializeApp();
            } else {
                alert('Password errata!');
            }
        }

        document.getElementById('password-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkPassword();
        });

        // Language
        function setLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateLanguage();
        }

        function updateLanguage() {
            const texts = {
                it: {
                    headerTitle: 'Musei di Venezia',
                    sidebarTitle: 'Legenda Musei',
                    duration: 'min'
                },
                en: {
                    headerTitle: 'Venice Museums',
                    sidebarTitle: 'Museums Legend',
                    duration: 'min'
                }
            };
            document.getElementById('header-title-text').textContent = texts[currentLanguage].headerTitle;
            document.getElementById('sidebar-title').textContent = texts[currentLanguage].sidebarTitle;
            renderPlacesList();
            if (currentPopup) currentPopup.remove();
        }

        // Initialize App
        function initializeApp() {
            initMap();
            renderPlacesList();
            addMarkers();
        }

        // Initialize Map
        function initMap() {
            map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/light-v11',
                center: [12.3350, 45.4371],
                zoom: 13.5
            });

            map.addControl(new mapboxgl.NavigationControl(), 'top-right');
        }

        // Render Places List
        function renderPlacesList() {
            const list = document.getElementById('places-list');
            list.innerHTML = '';
            
            museums.forEach(museum => {
                const item = document.createElement('div');
                item.className = 'place-item';
                item.onclick = () => {
                    document.querySelectorAll('.place-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    if (museum.coordinates) {
                        map.flyTo({ center: museum.coordinates, zoom: 16 });
                    }
                };
                
                const name = document.createElement('div');
                name.className = 'place-name';
                name.textContent = museum.name[currentLanguage];
                
                const duration = document.createElement('div');
                duration.className = 'place-duration';
                duration.textContent = museum.duration ? `‚è±Ô∏è ${museum.duration} ${currentLanguage === 'it' ? 'min' : 'min'}` : '';
                
                item.appendChild(name);
                item.appendChild(duration);
                list.appendChild(item);
            });
        }

        // Add Markers
        function addMarkers() {
            markers.forEach(marker => marker.remove());
            markers = [];

            museums.forEach(museum => {
                if (!museum.coordinates) return;

                const el = document.createElement('div');
                el.className = 'marker';
                el.innerHTML = 'üèõÔ∏è';
                el.style.fontSize = '28px';
                el.style.cursor = 'pointer';

                const marker = new mapboxgl.Marker(el)
                    .setLngLat(museum.coordinates)
                    .addTo(map);

                el.addEventListener('click', () => showPopup(museum));
                markers.push(marker);
            });
        }

        // Show Popup
        function showPopup(museum) {
            if (currentPopup) currentPopup.remove();

            let carouselIndex = 0;
            const subsections = museum.subsections || [];

            const popupContent = `
                <div class="popup-header">
                    <div class="popup-title">${museum.name[currentLanguage]}</div>
                    ${museum.duration ? `<div class="popup-duration">‚è±Ô∏è ${museum.duration} ${currentLanguage === 'it' ? 'minuti' : 'minutes'}</div>` : ''}
                </div>
                <div class="popup-body">
                    <div class="popup-main-description">${museum.description[currentLanguage]}</div>
                    
                    ${subsections.length > 0 ? `
                        <div class="carousel-container" id="carousel-${museum.id}">
                            ${subsections.map((section, idx) => `
                                <div class="carousel-section ${idx === 0 ? 'active' : ''}" data-index="${idx}">
                                    <div class="section-header" style="background: ${getColorForSection(idx)};">
                                        <div class="section-title">${section.title[currentLanguage]}</div>
                                        <div class="section-description">${section.description[currentLanguage]}</div>
                                    </div>
                                </div>
                            `).join('')}
                            
                            ${subsections.length > 1 ? `
                                <div class="carousel-nav">
                                    <button class="carousel-btn" onclick="changeSlide(${museum.id}, -1)">‚Üê</button>
                                    <div class="carousel-dots">
                                        ${subsections.map((_, idx) => `<div class="dot ${idx === 0 ? 'active' : ''}" data-index="${idx}"></div>`).join('')}
                                    </div>
                                    <button class="carousel-btn" onclick="changeSlide(${museum.id}, 1)">‚Üí</button>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                    
                    ${museum.howToArrive ? `
                        <div class="how-to-arrive">
                            <h4>üö¢ ${currentLanguage === 'it' ? 'Come Arrivare' : 'How to Get There'}</h4>
                            <p>${museum.howToArrive[currentLanguage]}</p>
                        </div>
                    ` : ''}
                </div>
            `;

            currentPopup = new mapboxgl.Popup({ maxWidth: '450px', offset: 25 })
                .setLngLat(museum.coordinates)
                .setHTML(popupContent)
                .addTo(map);
        }

        // Carousel Navigation
        window.changeSlide = function(museumId, direction) {
            const carousel = document.getElementById(`carousel-${museumId}`);
            const sections = carousel.querySelectorAll('.carousel-section');
            const dots = carousel.querySelectorAll('.dot');
            
            let currentIndex = Array.from(sections).findIndex(s => s.classList.contains('active'));
            let newIndex = currentIndex + direction;
            
            if (newIndex < 0) newIndex = sections.length - 1;
            if (newIndex >= sections.length) newIndex = 0;
            
            sections[currentIndex].classList.remove('active');
            dots[currentIndex].classList.remove('active');
            
            sections[newIndex].classList.add('active');
            dots[newIndex].classList.add('active');
        };

        // Color for sections
        function getColorForSection(index) {
            const colors = ['#f8f4f0', '#f0f8fa', '#faf0f5', '#f5f8f0', '#faf5f0'];
            return colors[index % colors.length];
        }

        // Admin Functions
        function toggleAdmin() {
            document.getElementById('admin-panel').classList.toggle('active');
        }

        function exportData() {
            const dataStr = JSON.stringify(museums, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'venezia-musei-backup.json';
            a.click();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    museums = data;
                    localStorage.setItem('venezia-musei-data', JSON.stringify(museums));
                    renderPlacesList();
                    addMarkers();
                    alert('Dati importati con successo!');
                } catch (err) {
                    alert('Errore nell\'importazione: file non valido');
                }
            };
            reader.readAsText(file);
        }

        function addNewPlace() {
            const name = prompt('Nome del museo (IT):');
            if (!name) return;
            
            const nameEn = prompt('Nome del museo (EN):');
            const duration = parseInt(prompt('Durata visita (minuti):') || '60');
            const lat = parseFloat(prompt('Latitudine:') || '45.4371');
            const lng = parseFloat(prompt('Longitudine:') || '12.3350');
            
            const newMuseum = {
                id: Date.now(),
                name: { it: name, en: nameEn || name },
                duration: duration,
                coordinates: [lng, lat],
                description: {
                    it: 'Descrizione da aggiungere',
                    en: 'Description to be added'
                },
                subsections: [],
                howToArrive: {
                    it: 'Da definire',
                    en: 'To be defined'
                }
            };
            
            museums.push(newMuseum);
            saveData();
            renderPlacesList();
            addMarkers();
            alert('Nuovo museo aggiunto!');
        }

        function resetToDefault() {
            if (confirm('Ripristinare i dati predefiniti? Tutti i dati attuali saranno persi.')) {
                museums = [...defaultMuseums];
                saveData();
                renderPlacesList();
                addMarkers();
                alert('Dati ripristinati!');
            }
        }

        function saveData() {
            localStorage.setItem('venezia-musei-data', JSON.stringify(museums));
        }
    </script>
</body>
</html>
